![HighscaleNotificationsystem.png](HighscaleNotificationsystem.png)

This diagram illustrates a high-scale, multi-region Global Notification System designed to handle 100M Daily Active Users (DAU) with bursts of 50k notifications/sec. It prioritizes low latency (< 2ms for global delivery), reliability, and regional isolation.

1. Multi-Region Infrastructure & User Routing

Regional Isolation: Datacenters are deployed in multiple regions (US, Europe, Asia) to keep services closer to users and ensure isolation.


Global User Registry: Instead of a centralized registry, it uses a geo-replicated data store (like DynamoDB Global Tables). This ensures that if a region goes down, user location info (e.g., User -> US-East) remains available globally.


Edge Caching: User sign-up info is pushed to CDN/Edge layers to cache location data, further reducing latency for initial connections.

2. Core Services & Notification Logic

Triggering Systems: Upstream systems like Payments and Marketing push notification requests into regional messaging queues (Kafka).

Notification Service: This central component orchestrates the flow. It determines if a notification is "Critical" (using an isCritical:true flag) to prioritize delivery.


User Preference Service: The system checks user settings (e.g., opt-in for Marketing vs. Security via SMS/Email) before sending.


Performance: Preferences are cached in-memory and refreshed every 1 minute.


Consistency: A Redis-based "Delta Check" with a 5-minute TTL is used to prevent unwanted notifications during the in-memory cache refresh window.

3. Scalability & Reliable Delivery

Queue Partitioning: To handle 50k events/sec, the messaging queues are scaled horizontally with high partition counts.

Tiered Delivery Channels:


Standard Topics: General notifications for Push, SMS, and Email.


Critical Topics: Dedicated "Critical" topics (e.g., cric_push) and workers ensure that urgent messages bypass standard traffic and are delivered in < 2 seconds.


Database Sharding: The Notifications DB is sharded to handle the massive write volume generated by 100M DAU that a single instance could not sustain.


Reliability Protocol: The Notification Service only acknowledges (ACK) the source Kafka message after the notification is successfully written and handed off to the appropriate channel queue.

We can also use the Transactional Outbox Pattern where the not service will write both data and message to be relayed to kafka in a outbound table in 1 transaction.
There would be relayers running which will pick the messages from outbound and write to kafka.
This ensures atomocity that db write and kafka write both happens.